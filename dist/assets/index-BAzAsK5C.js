import{j as e,ag as xe,v as he,T,s as me,P as c,b as pe,l as g,B as s,D as S,cq as O,S as A,a as k,cr as w,cs as K,n as N,c as je,f as ge,h as ee,G as z,ct as G,cu as se,r as u,g as be,V as fe,a3 as y,aw as ye,E as ve,u as Ce,Z as Te}from"./index-CMhOF5Py.js";import{T as De}from"./TableHeader-BUzY2eNg.js";import{q as Ie,t as re,a as ne,c as H}from"./data-BpFQCtIq.js";import{A as Ye,T as we}from"./index-DfXYYow6.js";import{u as E,b as Ne}from"./APIHooks-DItCotpK.js";import"./lodash-CW1nyizk.js";const Be=()=>e.jsxs(De,{sx:{borderBottom:"0 none",color:xe[500],"& .tableCell":{fontSize:13,padding:2,fontWeight:he.BOLD,backgroundColor:r=>r.palette.background.paper,"&:first-of-type":{pl:5},"&:last-of-type":{pr:5}}},children:[e.jsx(T,{className:"tableCell",children:"Pos"}),e.jsx(T,{className:"tableCell",align:"left",children:"Task Name"}),e.jsx(T,{className:"tableCell",align:"left",children:"Duration"}),e.jsx(T,{className:"tableCell",align:"center",colSpan:2,children:"Quantity"}),e.jsx(T,{className:"tableCell",align:"left",children:"Price Per Unit"}),e.jsxs(T,{className:"tableCell",align:"left",children:["Sub Total"," "]})]}),C=me(T)(()=>({fontSize:14,width:"fit-content",padding:8,"&:first-of-type":{paddingLeft:20},"&:last-of-type":{paddingRight:20}})),te=({data:r,index:o,currencyData:x,onChangeLineItems:n,onDeleteLineItem:h})=>{var m,b,l,f;return e.jsxs(pe,{sx:{position:"relative",".closeBtn":{visibility:"hidden",ml:3,pt:2,cursor:"pointer"},"&:hover":{".closeBtn":{visibility:"visible"}}},children:[e.jsx(C,{align:"left",children:r==null?void 0:r.id}),e.jsx(C,{align:"left",children:e.jsx(g,{autoFocus:!0,variant:"standard",value:(r==null?void 0:r.name)||"",placeholder:"Name",onChange:a=>n(o,"name",a.target.value)})}),e.jsx(C,{align:"left",sx:{whiteSpace:"inherit !important"},children:e.jsxs(s,{sx:{display:"flex"},children:[e.jsx(S,{sx:{height:40,mr:3,input:{padding:0,height:34},fieldset:{border:"none !important",borderBottom:"1px solid !important",borderColor:"divider",borderRadius:"0 !important"}},value:O((m=r==null?void 0:r.duration)==null?void 0:m.from),placeholder:"From",onChange:a=>n(o,"from",a,"duration")}),e.jsx(S,{sx:{height:40,input:{padding:0,height:34},fieldset:{border:"none !important",borderBottom:"1px solid !important",borderColor:"divider",borderRadius:"0 !important"}},value:O((b=r==null?void 0:r.duration)==null?void 0:b.to),placeholder:"To",onChange:a=>n(o,"to",a,"duration")})]})}),e.jsx(C,{align:"left",children:e.jsx(g,{type:"number",sx:{minWidth:50},variant:"standard",value:(l=r==null?void 0:r.quantity)==null?void 0:l.value,placeholder:"Value",onChange:a=>{n(o,"value",a.target.value,"quantity"),n(o,"total",a.target.value*(r==null?void 0:r.unitPrice)||0)}})}),e.jsx(C,{align:"left",children:e.jsx(A,{sx:{mr:2.5},variant:"standard",value:(f=r==null?void 0:r.quantity)==null?void 0:f.type,onChange:a=>{n(o,"type",a.target.value,"quantity")},children:Ie.map(a=>e.jsx(k,{value:a.value,sx:{cursor:"pointer",inputVariant:"outlined"},children:a.label},a.value))})}),e.jsx(C,{align:"left",children:e.jsx(g,{type:"number",variant:"standard",value:(r==null?void 0:r.unitPrice)||0,placeholder:"Unit Price",onChange:a=>{var p;n(o,"unitPrice",a.target.value),n(o,"total",a.target.value*((p=r==null?void 0:r.quantity)==null?void 0:p.value)||0)}})}),e.jsxs(C,{align:"left",sx:{width:"100%",display:"flex",alignItems:"center"},children:[w((r==null?void 0:r.total)||0,{language:x.language,currency:x.currency},2),e.jsx(s,{className:"closeBtn",onClick:()=>h(o),children:e.jsx(K,{size:15})})]})]},r==null?void 0:r.id)};te.propTypes={data:c.object.isRequired,index:c.number,currencyData:c.object,onChangeLineItems:c.func,onDeleteLineItem:c.func};const L=N().format("DD MMM YYYY"),le=({items:r,taxTypeData:o,taxRateData:x,currencyData:n,setCurrencyData:h,setItems:m,setTaxTypeData:b,setTaxRateData:l})=>{const f=(t,d,j,D)=>{const v=[...r];D?(D==="duration"&&(j=se(j,"DD MMM YYYY")),v[t][D][d]=j):v[t][d]=j,m(v)},a=t=>{const d=[...r];d.splice(t,1),m(d)},p=()=>r.reduce((t,d)=>t+d.total,0)||0;return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{children:e.jsxs(je,{stickyHeader:!0,className:"table",children:[e.jsx(we,{children:e.jsx(Be,{})}),e.jsx(ge,{children:r.map((t,d)=>e.jsx(te,{index:d,data:t,currencyData:n,onChangeLineItems:f,onDeleteLineItem:a},t.id))})]})}),e.jsxs(ee,{spacing:2,sx:{mt:10},children:[e.jsx(z,{item:!0,xs:12,md:6,children:e.jsxs(s,{sx:{color:"primary.main",display:"flex",alignItems:"center",mt:4,cursor:"pointer",width:"fit-content"},onClick:()=>m([...r,{id:r.length+1,duration:{from:L,to:L},quantity:{type:"fixed",value:1}}]),children:[e.jsx(G,{size:18}),e.jsx(s,{sx:{ml:2,fontSize:16},children:"Add Item"})]})}),e.jsxs(z,{item:!0,xs:12,md:5,sx:{ml:"auto",mr:10},children:[e.jsxs(s,{sx:{color:"text.secondary",mb:4,display:"flex",alignItems:"center"},children:[e.jsx(s,{sx:{mr:7,width:"100%"},children:"Subtotal:"}),e.jsx(s,{children:w(p(),{language:n.language,currency:n.currency},2)})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsx(A,{size:"small",sx:{mr:6,width:"100%"},value:o,onChange:t=>b(t.target.value),children:re.map(t=>e.jsx(k,{value:t.value,sx:{cursor:"pointer",inputVariant:"outlined"},children:t.label},t.value))}),e.jsx(A,{size:"small",sx:{mr:6,width:"100%"},value:x,onChange:t=>l(t.target.value),children:ne.map(t=>e.jsx(k,{value:t.value,sx:{cursor:"pointer",inputVariant:"outlined"},children:t.label},t.value))}),e.jsx(s,{sx:{color:"text.secondary"},children:w(p()*x*.01,{language:n.language,currency:n.currency},2)})]}),o==="cgst_sgst"&&e.jsxs(e.Fragment,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,color:"text.secondary"},children:[e.jsx(s,{sx:{width:"50%"}}),e.jsx(s,{sx:{ml:4,width:"50%"},children:" CGST:"}),e.jsx(s,{sx:{},children:w(p()*(x*.01)/2,{language:n.language,currency:n.currency},2)})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,color:"text.secondary"},children:[e.jsx(s,{sx:{width:"50%"}}),e.jsx(s,{sx:{ml:4,width:"50%"},children:" SGST:"}),e.jsx(s,{sx:{},children:w(p()*(x*.01)/2,{language:n.language,currency:n.currency},2)})]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,color:"text.secondary"},children:[e.jsx(s,{sx:{mr:6,width:"50%"},children:"Total:"}),e.jsx(A,{size:"small",sx:{mr:6,width:"50%"},value:n.currency,onChange:t=>{const d=H.find(j=>j.currency===t.target.value);h(d)},children:H.map(t=>e.jsx(k,{value:t.currency,sx:{cursor:"pointer",inputVariant:"outlined"},children:t.currency},t.currency))}),e.jsx(s,{children:w(p()*(1-x*.01),{language:n.language,currency:n.currency},2)})]})]})]})]})};le.propTypes={items:c.array,taxTypeData:c.string,taxRateData:c.number,currencyData:c.object,setCurrencyData:c.func,setItems:c.func,setTaxTypeData:c.func,setTaxRateData:c.func};const ae=({selectedInv:r,totalCount:o,clientsList:x,invoiceSettings:n,onSave:h})=>{const[m,b]=u.useState(H[0]),[l,f]=u.useState(null),[a,p]=u.useState(!1),[t,d]=u.useState(!1),[j,D]=u.useState([]),[v,W]=u.useState(N().format("YYYY-MM-DD")+"-"+(Number(o)+1)),[M,q]=u.useState(N()),[I,U]=u.useState(""),[ie,P]=u.useState(!1),[Q,Z]=u.useState(!1),[F,oe]=u.useState(30),[Y,_]=u.useState(""),[ce,R]=u.useState(!1),[J,X]=u.useState(re[0].value),[V,$]=u.useState(ne[0].value);u.useEffect(()=>{if(r){const i=x.find(B=>B.id===r.clientId);f(i),D(r.items),W(r.inum),q(O(r.idt)),U(r.introductionText),_(r.conclusionText),X(r.taxType),$(r.tax)}},[r]);const ue=()=>{const i=j.reduce((B,de)=>B+de.total,0);h({id:r?r.id:o+1,clientId:(l==null?void 0:l.id)||"",clientName:(l==null?void 0:l.name)||"",inum:v,idt:N(M,"DD/MM/YYYY").format("DD MMM YYYY"),dueDate:N(M,"DD/MM/YYYY").add(F,"days").format("DD MMM YYYY"),amount:i-i*V*.01,folderValue:120,tax:V,taxType:J,currency:m,introductionText:I,conclusionText:Y,items:j})};return e.jsxs(be,{title:"Invoice",sx:{width:"70%",margin:"auto"},children:[e.jsxs(s,{sx:{py:10,px:4},children:[e.jsxs(ee,{spacing:5,children:[e.jsx(z,{item:!0,xs:12,md:5,children:l?e.jsxs(s,{sx:{position:"relative",p:3,borderRadius:2,".closeBtn":{display:"none"},"&:hover":{border:"1px solid",borderColor:"divider",".closeBtn":{display:"block"}}},children:[e.jsx(s,{className:"closeBtn",sx:{position:"absolute",top:10,right:10,cursor:"pointer"},onClick:()=>f(null),children:e.jsx(K,{size:15})}),e.jsx(y,{variant:"h4",children:l.name}),e.jsxs(y,{variant:"h5",sx:{my:3},children:[l.firstName," ",l.lastName]}),e.jsxs(s,{sx:{mb:2},children:[l.steetName," ",l.steetName.length>0&&" , ",l.city," ",l.city.length>0&&" , ",l.zipCode," ",l.zipCode.length>0&&" , ",l.state," ",l.state.length>0&&" , ",l.country]}),e.jsxs(s,{sx:{mb:2},children:["VAT ID: ",l.vatId]})]}):e.jsx(fe,{size:"small",options:x,getOptionLabel:i=>i.name,value:l,onChange:(i,B)=>{f(B)},filterSelectedOptions:!0,renderInput:i=>e.jsx(g,{...i,variant:"outlined",label:"Add Client",fullWidth:!0})})}),(n==null?void 0:n.general)&&e.jsxs(z,{item:!0,xs:12,md:6,sx:{ml:"auto",display:"flex",alignItems:"flex-start"},children:[e.jsxs(s,{sx:{width:"50%"},children:[e.jsx(y,{variant:"h4",sx:{mb:3},children:n.general.agencyName}),e.jsx(y,{variant:"h4",sx:{mb:3},children:n.general.agencyName}),e.jsxs(s,{sx:{mb:3},children:[e.jsx(s,{children:n.general.streetName}),e.jsx(s,{children:n.general.state}),e.jsxs(s,{children:[n.general.zipCode," ",n.general.country]})]}),e.jsxs(s,{sx:{mb:3},children:[e.jsx(s,{children:n.general.phoneNumber}),e.jsx(s,{children:n.invoicing.email})]}),e.jsxs(s,{sx:{mb:3},children:[e.jsxs(s,{children:["VAT ID: ",n.accounting.vatId]}),e.jsxs(s,{children:["Tax ID: ",n.accounting.taxId]})]})]}),(n==null?void 0:n.invoicing)&&e.jsx(s,{sx:{width:"50%",ml:4},children:n.invoicing.logo&&e.jsx("img",{src:n.invoicing.logo,alt:"logo",style:{width:70,height:"auto"}})})]})]}),e.jsx(y,{variant:"h2",sx:{mb:3},children:"Invoice"}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",mb:4},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",borderRadius:2,p:1,"&:hover":{border:a?"none":"1px solid",borderColor:"divider"}},children:[e.jsx(s,{component:"span",sx:{mr:2},children:"Invoice ID:"}),a?e.jsx(g,{autoFocus:!0,size:"small",variant:"outlined",value:v,onChange:i=>W(i.target.value),onBlur:()=>p(!1)}):e.jsx(s,{onClick:()=>p(!0),children:v})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",borderRadius:2,p:1,"&:hover":{border:t?"none":"1px solid",borderColor:"divider"}},children:[e.jsx(s,{component:"span",sx:{mr:2},children:"Invoice Date:"}),t?e.jsx(S,{value:N(M,"DD/MM/YYYY"),onChange:i=>{q(i),d(!1)},renderInput:i=>e.jsx(g,{autoFocus:!0,size:"small",sx:{width:190},onBlur:()=>d(!1),...i})}):e.jsx(s,{onClick:()=>d(!0),children:se(M,"DD/MM/YYYY")})]})]}),e.jsx(s,{sx:{mb:4},children:ie?e.jsx(g,{autoFocus:!0,variant:"outlined",value:I,onChange:i=>U(i.target.value),onBlur:()=>P(!1)}):(I==null?void 0:I.length)>0?e.jsx(s,{onClick:()=>P(!0),children:I}):e.jsxs(s,{sx:{color:"primary.main",display:"flex",alignItems:"center"},onClick:()=>P(!0),children:[e.jsx(G,{size:18}),e.jsx(s,{sx:{ml:2,fontSize:16},children:"Add Introduction text (Optional)"})]})})]}),e.jsx(le,{items:j,setItems:D,taxTypeData:J,taxRateData:V,setTaxTypeData:X,setTaxRateData:$,currencyData:m,setCurrencyData:b}),e.jsxs(s,{sx:{py:10,px:4},children:[e.jsx(s,{sx:{mb:4},children:Q?e.jsx(g,{autoFocus:!0,type:"number",variant:"outlined",value:F,onChange:i=>oe(i.target.value),onBlur:()=>Z(!1)}):e.jsxs(s,{onClick:()=>Z(!0),sx:{borderRadius:2,p:1,"&:hover":{border:Q?"none":"1px solid",borderColor:"divider"}},children:[e.jsx(y,{variant:"h4",sx:{mb:1},children:"Payment Terms"}),e.jsxs(y,{variant:"body1",sx:{mb:4},children:["Please Pay within ",F," days of receiving this invoice."]})]})}),e.jsx(s,{sx:{mb:3},children:ce?e.jsx(g,{autoFocus:!0,variant:"outlined",value:Y,onChange:i=>_(i.target.value),onBlur:()=>R(!1)}):(Y==null?void 0:Y.length)>0?e.jsx(s,{onClick:()=>R(!0),children:Y}):e.jsxs(s,{sx:{color:"primary.main",display:"flex",alignItems:"center"},onClick:()=>R(!0),children:[e.jsx(G,{size:18}),e.jsx(s,{sx:{ml:2,fontSize:16},children:"Add concluding text (Optional)"})]})}),e.jsx(ye,{}),(n==null?void 0:n.accounting)&&e.jsxs(s,{sx:{position:"relative",p:3,my:4,borderRadius:2,border:"1px solid",borderColor:"divider",width:"fit-content"},children:[e.jsx(y,{variant:"h4",sx:{mb:4},children:"Bank Account"}),e.jsxs(s,{sx:{color:"text.primary"},children:[e.jsxs(s,{children:["Receiver: ",n.accounting.accountHolder]}),e.jsxs(s,{children:["Bank Name: ",n.accounting.bankName]}),e.jsxs(s,{children:["Country of bank: ",n.accounting.countryOfBank]}),e.jsxs(s,{children:["Account Number: ",n.accounting.accountNumber]}),e.jsxs(s,{children:["SWIFT/BIC: ",n.accounting.swiftBic]}),e.jsxs(s,{children:["IFSC: ",n.accounting.ifsc]})]})]}),e.jsx(s,{sx:{textAlign:"right"},children:e.jsx(ve,{variant:"contained",onClick:ue,children:"Send Invoice"})})]})]})};ae.propTypes={selectedInv:c.object,totalCount:c.number,clientsList:c.array,invoiceSettings:c.object,onSave:c.func};const Re=()=>{const r=Ce(),o=Te(),[{apiData:x}]=E("/api/invoice/clients",{},{},!0),[{apiData:n}]=E("/api/invoice/settings",{},{},!0),[{apiData:h}]=E("/api/invoice/list",{},{},!0),m=b=>{Ne("/api/invoice/list/add",o,{invoice:b}).then(()=>{o.showMessage("New Invoice has been created successfully!")}).catch(l=>{o.fetchError(l.message)}),r("/invoice/home")};return x&&(h==null?void 0:h.length)&&e.jsx(ae,{clientsList:x,totalCount:(h==null?void 0:h.length)||0,invoiceSettings:n,onSave:m})};export{Re as default};
